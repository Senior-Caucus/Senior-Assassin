{% extends "base.html" %}

{% block title %}Target{% endblock %}

{% block content %}
  <div class="target-page">
    <h2 class="nosifer-regular">Select a User</h2>
    <select id="user-select">
      {% for user in users %}
        <option value="{{ user.email }}">{{ user.fullName }} ({{ user.hearts|default('0') }}‚ù§)</option>
      {% endfor %}
    </select>
    <div id="user-info">
      <!-- User info will be filled by JS -->
    </div>

    <button id="rules-btn">Instructions/Rules v2</button>

    <button id="open-evidence" class="action-btn">Submit Evidence</button>

    <!-- Modal Form -->
    <div id="evidence-modal" class="modal hidden">
      <div class="modal-content">
        <button class="close-btn">&times;</button>
        <h3>Submit Evidence</h3>
        <form id="evidence-form" method="post" enctype="multipart/form-data">
          <label for="video">Video Evidence (max 25MB):</label>
          <input type="file" name="video" id="video" accept="video/*" required>

          <label for="comments">Comments:</label>
          <textarea name="comments" id="comments" rows="4" placeholder="Optional..."></textarea>
          <input type="hidden" name="target_email" id="target_email" value="">
          <input type="hidden" name="user_email" value="{{ user_email }}">
          <!-- Progress UI -->
          <div id="progress-container" class="hidden">
            <div id="upload-progress"></div>
          </div>
          <p id="upload-msg" class="upload-msg"></p>
          <button type="submit" class="submit-btn" id="submit-evidence-btn">Submit</button>
        </form>
      </div>
    </div>
  </div>

  <div id="target-profile-pic-reroute">
    <p><a href="/profile">Change Profile Picture</a></p>
  </div>

  <div class="footer-spacer" style="display:none;"></div>
{% endblock %}

{% block scripts %}
<script type="application/javascript">
// Safely inject JSON using backticks for template literals
var ALL_USERS = JSON.parse(`{{ users|tojson|safe }}`);
var EVIDENCE = JSON.parse(`{{ evidence|tojson|safe }}`);
var CURRENT_USER_EMAIL = "{{ user_email }}";
</script>
<script src="/static/js/target.js"></script>
<!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-076DG6NV1N"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-076DG6NV1N');
  </script>
{% endblock %}