{% extends "base.html" %}

{% block title %}Target{% endblock %}

{% block content %}
  <div class="target-page">
    <h2 class="nosifer-regular">TARGET: {{ target_name }}</h2>
    <div class="target-info">
      <p><strong>Height:</strong> {{ target_height }}</p>
      <p><strong>Schedule:</strong></p>
      <!-- schedule contains comma delimited values representing period 1, 2, 3, etc -->
      <!-- let's make a table with period and class as the header -->
      <table>
        <thead>
          <tr>
            <th>Period</th>
            <th>Class</th>
          </tr>
        </thead>
        <tbody>
          {% for period, class_name in target_schedule.items() %}
            <tr>
              <td>{{ period }}</td>
              <td>{{ class_name }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <div class="target-image">
      <!-- picture is an io.bytesIO object -->
      {% if target_picture %}
        <img src="{{ target_picture }}" alt="Target Picture">
      {% else %}
        <p>No picture available</p>
      {% endif %}
    </div>

    <div class="target-safety">
      <p>Today's safety object: {{ today_safety }}</p>
      <p>Hint for tomorrow's object: {{ tmr_hint }}</p>
    </div>

    <button id="open-evidence" class="action-btn">Submit Evidence</button>

    <!-- Modal Form -->
    <div id="evidence-modal" class="modal hidden">
      <div class="modal-content">
        <button class="close-btn">&times;</button>
        <h3>Submit Evidence</h3>
        <form id="evidence-form" method="post" enctype="multipart/form-data">
          <label for="video">Video Evidence (max 25MB):</label>
          <input type="file" name="video" id="video" accept="video/*" required>

          <label for="comments">Comments:</label>
          <textarea name="comments" id="comments" rows="4" placeholder="Optional..."></textarea>
          <!-- Hidden field with the target's email -->
          <input type="hidden" name="target_email" value="{{ target_email }}">
          <input type="hidden" name="user_email" value="{{ user_email }}">
          <!-- Progress UI -->
          <div id="progress-container" class="hidden">
            <div id="upload-progress"></div>
          </div>
          <p id="upload-msg" class="upload-msg"></p>
          <button type="submit" class="submit-btn">Submit</button>
        </form>
      </div>
    </div>

    <!-- Rules Toggle -->
    <button id="rules-btn">Instructions/Rules</button>
  </div>
  <div class="footer-spacer" style="display:none;"></div>
{% endblock %}

{% block scripts %}
<script src="/static/js/target.js"></script>
{% endblock %}